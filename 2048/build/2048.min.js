var game={data:[],RN:4,CN:4,score:0,state:1,RUNNING:1,GAMEOVER:0,start:function(){this.state=this.RUNNING;this.score=0;for(var a=0;a<this.RN;a++){this.data.push([]);for(var b=0;b<this.CN;b++){this.data[a][b]=0}}this.randomNum();this.randomNum();this.updateView();document.onkeydown=function(c){if(this.state===this.RUNNING){switch(c.keyCode){case 37:this.moveLeft();break;case 38:this.moveUp();break;case 39:this.moveRight();break;case 40:this.moveDown();break;default:break}}}.bind(this)},restart:function(){document.getElementById("btn").onclick=function(){this.start()}.bind(this)},move:function(b){var a=String(this.data);b.call(this);var c=String(this.data);if(a!==c){this.randomNum();this.isGameOver()&&(this.state=this.GAMEOVER);this.updateView()}},moveDown:function(){this.move(function(){for(var a=0;a<this.CN;a++){this.moveDownInCol(a)}})},moveUp:function(){this.move(function(){for(var a=0;a<this.CN;a++){this.moveUpInCol(a)}})},moveRight:function(){this.move(function(){for(var a=0;a<this.RN;a++){this.moveRightInRow(a)}})},moveLeft:function(){this.move(function(){for(var a=0;a<this.RN;a++){this.moveLeftInRow(a)}})},moveDownInCol:function(d){for(var b=this.RN-1;b>0;b--){var a=this.getPrevInCol(b,d);if(a===-1){break}else{if(this.data[b][d]===0){this.data[b][d]=this.data[a][d];this.data[a][d]=0;b++}else{if(this.data[b][d]===this.data[a][d]){this.data[b][d]*=2;this.score+=this.data[b][d];this.data[a][d]=0}}}}},moveUpInCol:function(d){for(var b=0;b<this.RN-1;b++){var a=this.getNextInCol(b,d);if(a===-1){break}else{if(this.data[b][d]===0){this.data[b][d]=this.data[a][d];this.data[a][d]=0;b--}else{if(this.data[b][d]===this.data[a][d]){this.data[b][d]*=2;this.score+=this.data[b][d];this.data[a][d]=0}}}}},moveRightInRow:function(a){for(var d=this.CN-1;d>0;d--){var b=this.getPrevInRow(a,d);if(b===-1){break}else{if(this.data[a][d]===0){this.data[a][d]=this.data[a][b];this.data[a][b]=0;d++}else{if(this.data[a][d]===this.data[a][b]){this.data[a][d]*=2;this.score+=this.data[a][d];this.data[a][b]=0}}}}},moveLeftInRow:function(a){for(var d=0;d<this.CN-1;d++){var b=this.getNextInRow(a,d);if(b===-1){break}else{if(this.data[a][d]===0){this.data[a][d]=this.data[a][b];this.data[a][b]=0;d--}else{if(this.data[a][d]===this.data[a][b]){this.data[a][d]*=2;this.score+=this.data[a][d];this.data[a][b]=0}}}}},getPrevInCol:function(a,b){a--;for(;a>=0;a--){if(this.data[a][b]!==0){return a}}return -1},getNextInCol:function(a,b){a++;for(;a<this.RN;a++){if(this.data[a][b]!==0){return a}}return -1},getPrevInRow:function(a,b){b--;for(;b>=0;b--){if(this.data[a][b]!==0){return b}}return -1},getNextInRow:function(a,b){b++;for(;b<this.CN;b++){if(this.data[a][b]!==0){return b}}return -1},isGameOver:function(){for(var a=0;a<this.RN;a++){for(var b=0;b<this.CN;b++){if(this.data[a][b]===0||a<this.RN-1&&(this.data[a][b]===this.data[a+1][b])||b<this.CN-1&&(this.data[a][b]===this.data[a][b+1])){return false}}}this.restart();return true},updateView:function(){for(var a=0;a<this.RN;a++){for(var d=0;d<this.CN;d++){var b=document.getElementById("c"+a+d);if(this.data[a][d]!==0){b.innerHTML=this.data[a][d];b.className="cell n"+this.data[a][d]}else{b.innerHTML="";b.className="cell"}}}document.getElementById("score").innerHTML=this.score;document.getElementById("gameOver").style.display=this.state===this.GAMEOVER?"block":"none";this.state===this.GAMEOVER&&(document.getElementById("final").innerHTML=this.score)},randomNum:function(){while(true){var a=Math.floor(Math.random()*this.RN);var b=Math.floor(Math.random()*this.CN);if(this.data[a][b]===0){this.data[a][b]=Math.random()>0.5?2:4;break}}}};game.start();